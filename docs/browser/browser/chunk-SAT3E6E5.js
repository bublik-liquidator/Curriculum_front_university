import{b as I}from"./chunk-BV4LH35L.js";import{a as w}from"./chunk-ZJPYNRJX.js";import{a as F}from"./chunk-ZKR5I6TR.js";import{a as j}from"./chunk-3Y7LXGE2.js";import"./chunk-BYXBJQAS.js";import{a as K,c as S}from"./chunk-MQ2KE6ET.js";import{a as k,c as N,d as X,e as Z}from"./chunk-RSBSJUL2.js";import{A as L,Aa as _,Ba as g,F as c,G as o,H as x,La as E,Oa as z,P as Y,Pa as G,T as y,U as C,a as B,b as O,ba as $,c as U,ca as d,f as P,g as V,ha as H,j as T,ja as Q,l as m,lb as J,n as b,na as A,ra as f,sa as v,ta as W,u as R,xa as q,y as u}from"./chunk-3IDQFMH7.js";function ae(h,p){if(h&1){let l=q();f(0,"tablec",8),_("downloadCallback",function(e){y(l);let i=g();return C(i.downloadFile(e))})("delete",function(e){y(l);let i=g();return C(i.onDelete(e))})("edit",function(e){y(l);let i=g();return C(i.onEdit(e))})("pageChange",function(e){y(l);let i=g();return C(i.onPageChange(e,i.currentSearchQuery))}),v()}if(h&2){let l=g();Q("pageIndex",l.pageIndex)("data",l.tableData)("totalCount",l.totalCount)}}var je=(()=>{let p=class p{constructor(t,e,i,r,a,s,n){this.curriculumService=t,this.dialog=e,this.specialtyService=i,this.statusService=r,this.userService=a,this.educationService=s,this.loginService=n,this.destroySubject=new V,this.currentSearchQuery="",this.checkToken=!1,this.pageIndex=1}ngOnInit(){this.getCurriculums(this.pageIndex,10),this.getSpecialties(),this.getStatuses(),this.getUsers(),this.getEducations(),this.checkTokenFun()}getEducations(){this.educationService.getEducations().pipe(o(this.destroySubject)).subscribe(t=>{this.educations=t})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}checkTokenFun(){this.checkToken=this.loginService.checkToken("isAdmin"),this.activeUser=this.loginService.checkToken("name")}onPageChange(t,e=""){this.currentSearchQuery=e,this.pageIndex=t,this.curriculumService.searchCurriculums(e,t,10).pipe(o(this.destroySubject),u(i=>(this.openModal(i.error),m(null)))).subscribe(i=>{i&&(this.curriculums=i.curriculums,this.totalCount=i.total,this.tableData=this.mapToTableData(i.curriculums))})}getCurriculums(t,e){this.curriculumService.getCurriculums(t,e).pipe(o(this.destroySubject),u(i=>(this.openModal(i.error),m(null)))).subscribe(i=>{i&&(this.curriculums=i.curriculums,this.totalCount=i.total,this.tableData=this.mapToTableData(i.curriculums))})}getSpecialties(){this.specialtyService.getSpecialties().pipe(o(this.destroySubject)).subscribe(t=>{this.specialties=t})}getStatuses(){this.statusService.getStatuses().pipe(o(this.destroySubject)).subscribe(t=>{this.statuses=t})}getUsers(){this.userService.getUsersForCurriculas().pipe(o(this.destroySubject)).subscribe(t=>{this.users=t.users})}getSpecialtiesById(t){this.specialtyService.getSpecialtiesById(t).pipe(o(this.destroySubject)).subscribe(e=>{this.specialtiesById=e})}onEdit(t){this.curriculumService.getCurriculumById(t).pipe(c(e=>this.getListOfSpecialtiesById(t).pipe(b(i=>({curriculum:e,listOfSpecialties:i})))),c(({curriculum:e,listOfSpecialties:i})=>{let r=[{field:"title",fieldName:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",type:"string",value:e.title},{field:"year",fieldName:"\u0413\u043E\u0434",type:"number",value:e.year},{field:"statusName",fieldName:"\u0421\u0442\u0430\u0442\u0443\u0441",type:"select",value:e.statusName,options:this.statuses.map(n=>({value:n.name}))},{field:"filePath",fieldName:"Upload Word File",type:"button",value:"\u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0444\u0430\u0439\u043B",click:()=>this.uploadFile(t)},{field:"educationFormName",fieldName:"\u0424\u043E\u0440\u043C\u0430 \u043E\u0431\u0443\u0447\u0435\u043D\u0438\u044F",type:"select",value:e.educationFormName,options:this.educations.map(n=>({value:n.name}))},{field:"Specialties",fieldName:"\u0421\u043F\u0435\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0441\u0442\u0438",type:"checkbox",value:i},{field:"expiryDate",fieldName:"\u041E\u043A\u043E\u043D\u0447\u0430\u043D\u0438\u0435",type:"date",value:e.expiryDate}];this.checkToken?r.push({field:"developerName",fieldName:"\u0412\u0435\u0434\u0443\u0449\u0438\u0439",type:"select",value:e.developerName,options:this.users.map(n=>({value:n.name}))}):r.push({field:"developerName",fieldName:"\u0412\u0435\u0434\u0443\u0449\u0438\u0439",type:"info",value:this.activeUser});let a=[{field:"save-button ",type:"submit",value:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"},{field:"cancel-button",fieldName:"Cancel",type:"button",value:"\u041E\u0442\u043C\u0435\u043D\u0430",click:()=>s.close()}],s=this.dialog.open(S,{data:{fields:r,buttons:a}});return s.afterClosed().pipe(L(1),R(n=>!!n),x(n=>{this.saveCurriculum(n,t)}))}),u(e=>(console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445:",e),this.openModal(e.error.error),m(null)))).subscribe()}createCurriculum(){return this.getListOfSpecialtiesById().pipe(b(t=>{let e=[{field:"title",fieldName:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",type:"string",value:"\u0422\u0435\u0441\u04421"},{field:"year",fieldName:"\u0413\u043E\u0434",type:"number",value:new Date().getFullYear()},{field:"statusName",fieldName:"\u0421\u0442\u0430\u0442\u0443\u0441",type:"select",value:this.statuses[0].name,options:this.statuses.map(a=>({value:a.name}))},{field:"Specialties",fieldName:"\u0421\u043F\u0435\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0441\u0442\u0438",type:"checkbox",value:t},{field:"educationFormName",fieldName:"\u0424\u043E\u0440\u043C\u0430 \u043E\u0431\u0443\u0447\u0435\u043D\u0438\u044F",type:"select",value:this.educations[0].name,options:this.educations.map(a=>({value:a.name}))},{field:"expiryDate",fieldName:"\u041E\u043A\u043E\u043D\u0447\u0430\u043D\u0438\u0435",type:"date",value:new Date(new Date().setFullYear(new Date().getFullYear()+1))}];this.checkToken?e.push({field:"developerName",fieldName:"\u0412\u0435\u0434\u0443\u0449\u0438\u0439",type:"select",value:this.users[0].name,options:this.users.map(a=>({value:a.name}))}):e.push({field:"developerName",fieldName:"\u0412\u0435\u0434\u0443\u0449\u0438\u0439",type:"info",value:this.loginService.checkToken("name")});let i=[{field:"save-button ",type:"submit",value:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C"},{field:"cancel-button",fieldName:"Cancel",type:"button",value:"\u041E\u0442\u043C\u0435\u043D\u0430",click:()=>r.close()}],r=this.dialog.open(S,{data:{fields:e,buttons:i}});return this.specialties,r.afterClosed().pipe(c(a=>a?this.createFile(a).pipe(u(s=>(this.openModal(s.error.error),console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u0444\u0430\u0439\u043B\u0430:",s),T)),c(s=>s?this.curriculumService.createCurriculum(a,s):m(null)),x(()=>{this.getCurriculums(this.pageIndex,10)})):m(null)),o(this.destroySubject))}),c(t=>t)).subscribe()}createFile(t){let e=document.createElement("input");e.type="file",e.accept=".doc,.docx";let i=`${t.title}_${t.year}_${t.educationFormName}_${t.developerName}`;return new P(r=>{e.onchange=a=>{let s=a.target;if(s.files&&s.files.length>0){let n=s.files[0],D=new File([n],i,{type:n.type});r.next(D),r.complete()}},e.click(),this.getCurriculums(this.pageIndex,10)})}getListOfSpecialtiesById(t){return t?this.specialtyService.getSpecialtiesById(t).pipe(b(e=>(this.specialtiesById=e,this.specialties.map(r=>({id:r.id,name:r.name,selected:!!(this.specialtiesById&&this.specialtiesById.find(a=>a.id===r.id))})))),o(this.destroySubject)):m(this.specialties.map(e=>({id:e.id,name:e.name,selected:!1})))}uploadFile(t){let e=document.createElement("input");e.type="file",e.accept=".doc,.docx",e.onchange=i=>{let r=i.target;if(r.files&&r.files.length>0){let a=r.files[0];this.curriculumService.updateFileById(t,a).pipe(c(()=>this.openModal("\u0424\u0430\u0439\u043B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D")),u(s=>this.openModal(s.error.error)),o(this.destroySubject)).subscribe()}},e.click()}saveCurriculum(t,e){this.curriculumService.updateCurriculumById(e,t).pipe(x(()=>{this.openModal("\u0414\u0430\u043D\u043D\u044B\u0435 \u0443\u0447\u0435\u0431\u043D\u043E\u0439 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u044B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B"),this.getCurriculums(this.pageIndex,10)}),u(i=>this.openModal(i.error.error)),o(this.destroySubject)).subscribe()}openModal(t){let e=this.dialog.open(S,{data:{fields:[{field:"name",type:"info",value:t}]}});return e.afterClosed().pipe(b(()=>e),o(this.destroySubject))}mapToTableData(t){return t.map(ne=>{var M=ne,{id:e,lastModified:i,expiryDate:r,developerId:a,developerName:s,statusId:n,statusName:D,educationFormName:ee,educationFormId:se,title:te,year:ie}=M,re=U(M,["id","lastModified","expiryDate","developerId","developerName","statusId","statusName","educationFormName","educationFormId","title","year"]);return O(B({id:e,\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435:te,\u0421\u043A\u0430\u0447\u0430\u0442\u044C:{display:"\u0441\u043A\u0430\u0447\u0430\u0442\u044C",download:()=>this.downloadFile(e)},\u0413\u043E\u0434:ie,\u0412\u0435\u0434\u0443\u0449\u0438\u0439:s,\u0424\u043E\u0440\u043C\u0430:ee,\u0421\u0442\u0430\u0442\u0443\u0441\u044B:D},re),{\u0418\u0437\u043C\u0435\u043D\u0451\u043D:new Date(i).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit"}),"\u0421\u0440\u043E\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F":new Date(r).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit"})})})}downloadFile(t){this.curriculumService.saveCurriculumAsWordToClient(t)}onDelete(t){let e=[{field:"name",type:"info",value:"\u0412\u044B \u0442\u043E\u0447\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u0443\u044E \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0443?"}],i=[{field:"save-button ",type:"submit",value:"\u0414\u0430"},{field:"cancel-button",fieldName:"Cancel",type:"button",value:"\u041D\u0435\u0442",click:()=>r.close()}],r=this.dialog.open(S,{data:{fields:e,buttons:i}});r.afterClosed().pipe(c(()=>this.curriculumService.deleteCurriculum(t)),u(a=>(console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u044B:",a),this.openModal(a.error.error),T)),o(this.destroySubject)).subscribe(()=>{this.getCurriculums(this.pageIndex,10)})}};p.\u0275fac=function(e){return new(e||p)(d(N),d(K),d(w),d(j),d(k),d(F),d(I))},p.\u0275cmp=Y({type:p,selectors:[["curriculum-content"]],standalone:!0,features:[z([N,w,j,k,F,I]),G],decls:11,vars:1,consts:[[1,"main-container"],[1,"title"],[1,"search-and-button"],[1,"search-bar"],[3,"searchEvent"],[1,"create-curriculum-button",3,"click"],[1,"tablic"],[3,"pageIndex","data","totalCount"],[3,"pageIndex","data","totalCount","downloadCallback","delete","edit","pageChange"]],template:function(e,i){e&1&&(f(0,"div",0)(1,"div",1),E(2,"\u0423\u0447\u0435\u0431\u043D\u044B\u0435 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u044B"),v(),W(3,"br"),f(4,"div",2)(5,"div",3)(6,"search",4),_("searchEvent",function(a){return i.onPageChange(1,a)}),v()(),f(7,"button",5),_("click",function(){return i.createCurriculum()}),E(8," \u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0443\u0447\u0435\u0431\u043D\u0443\u044E \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0443 "),v()(),f(9,"div",6),H(10,ae,1,3,"tablec",7),v()()),e&2&&($(10),A(10,i.tableData?10:-1))},dependencies:[X,J,Z],styles:[".title[_ngcontent-%COMP%]{color:var(--Colors-gray-600, #475569);white-space:nowrap;font:400 24px/32px Inter,-apple-system,Roboto,Helvetica,sans-serif;padding-left:3px}.create-curriculum-button[_ngcontent-%COMP%]{color:var(--Colors-white, #fff);white-space:nowrap;border-radius:4px;box-shadow:0 1px 2px -1px #0000001a,0 1px 3px #0000001a;background-color:var(--Colors-primary-500, #0ea5e9);align-self:stretch;justify-content:center;padding:8px 16px;font:800 16px/143% Inter,-apple-system,Roboto,Helvetica,sans-serif;border:none;cursor:pointer;margin-left:auto}.search-and-button[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.main-container[_ngcontent-%COMP%]{border-radius:8px;justify-content:space-between;display:flex;flex-direction:column;padding-top:20px;padding-right:30px;padding-left:20px}"]});let h=p;return h})();export{je as CurriculumContentComponent};
