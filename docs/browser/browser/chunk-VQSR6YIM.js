import{b as f}from"./chunk-BV4LH35L.js";import{a as b}from"./chunk-ZJPYNRJX.js";import{a as y}from"./chunk-ZKR5I6TR.js";import{a as C}from"./chunk-3Y7LXGE2.js";import"./chunk-BYXBJQAS.js";import{a as J,c as K}from"./chunk-MQ2KE6ET.js";import{a as S,b as se,d as N,e as X}from"./chunk-RSBSJUL2.js";import{Aa as j,Ba as l,G as n,Jb as p,K as F,La as L,N as P,Oa as Q,P as B,Pa as W,T as d,U as m,a as k,b as E,ba as M,c as A,ca as a,e as oe,g as U,ha as O,ib as q,ja as V,jb as z,l as v,lb as G,n as I,na as $,ra as h,sa as g,ta as H,xa as R,y as w}from"./chunk-3IDQFMH7.js";var Y=oe(se());var x=(()=>{let o=class o{constructor(e){this.http=e}getExpiringCurriculums(e=1,t=10){let i=new q().set("page",e.toString()).set("limit",t.toString());return this.http.get(`${p.serverUrl}/archive/get-expiring-curriculums`,{params:i})}saveCurriculumAsWordToClient(e){this.http.post(`${p.serverUrl}/curriculum/save-curriculum-asWord-to-client/${e}`,{id:e},{responseType:"blob",observe:"response"}).subscribe(t=>{let r=(t.headers.get("content-disposition")||"").split(";")[1]?.split("=")[1]||`file${e}.docx`;t.body&&(0,Y.default)(t.body,r)})}getCurriculumById(e){return this.http.get(`${p.serverUrl}/archive/get-curriculum/${e}`)}getCurriculums(e=1,t=10){let i={page:e.toString(),limit:t.toString()},r=`${p.serverUrl}/archive/get-curriculums`;return console.log("HTTP Request:","POST",r,i),this.http.post(r,i)}searchCurriculums(e="",t=1,i=10){let r={search:e,limit:i,page:t};return console.log(r),this.http.post(`${p.serverUrl}/archive/search-curriculums`,r)}};o.\u0275fac=function(t){return new(t||o)(P(z))},o.\u0275prov=F({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function ae(s,o){if(s&1){let c=R();h(0,"tablec",7),j("downloadCallback",function(t){d(c);let i=l();return m(i.downloadFile(t))})("delete",function(t){d(c);let i=l();return m(i.onDelete(t))})("edit",function(t){d(c);let i=l();return m(i.onEdit(t))})("pageChange",function(t){d(c);let i=l();return m(i.onPageChange(t,i.currentSearchQuery))}),g()}if(s&2){let c=l();V("pageIndex",c.pageIndex)("data",c.tableData)("totalCount",c.totalCount)}}var Fe=(()=>{let o=class o{constructor(e,t,i,r,u,_,T){this.curriculumArchiveService=e,this.dialog=t,this.specialtyService=i,this.statusService=r,this.userService=u,this.educationService=_,this.loginService=T,this.destroySubject=new U,this.currentSearchQuery="",this.checkToken=!1,this.pageIndex=1}ngOnInit(){this.getCurriculums(this.pageIndex,10),this.getSpecialties(),this.getStatuses(),this.getUsers(),this.getEducations(),this.checkTokenFun()}getEducations(){this.educationService.getEducations().pipe(n(this.destroySubject)).subscribe(e=>{this.educations=e})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}checkTokenFun(){this.checkToken=this.loginService.checkToken("isAdmin"),this.activeUser=this.loginService.checkToken("name")}onPageChange(e,t=""){this.currentSearchQuery=t,this.pageIndex=e,this.curriculumArchiveService.searchCurriculums(t,e,10).pipe(n(this.destroySubject),w(i=>(this.openModal(i.error),v(null)))).subscribe(i=>{i&&(this.archiveCurriculums=i.curriculums,this.totalCount=i.total,this.tableData=this.mapToTableData(i.curriculums))})}getCurriculums(e,t){this.curriculumArchiveService.getCurriculums(e,t).pipe(n(this.destroySubject),w(i=>(this.openModal(i.error),v(null)))).subscribe(i=>{i&&(this.archiveCurriculums=i.curriculums,this.totalCount=i.total,this.tableData=this.mapToTableData(i.curriculums))})}getSpecialties(){this.specialtyService.getSpecialties().pipe(n(this.destroySubject)).subscribe(e=>{this.specialties=e})}getStatuses(){this.statusService.getStatuses().pipe(n(this.destroySubject)).subscribe(e=>{this.statuses=e})}getUsers(){this.userService.getUsersForCurriculas().pipe(n(this.destroySubject)).subscribe(e=>{this.users=e.users})}getSpecialtiesById(e){this.specialtyService.getSpecialtiesById(e).pipe(n(this.destroySubject)).subscribe(t=>{this.specialtiesById=t})}getListOfSpecialtiesById(e){return e?this.specialtyService.getSpecialtiesById(e).pipe(I(t=>(this.specialtiesById=t,this.specialties.map(r=>({id:r.id,name:r.name,selected:!!(this.specialtiesById&&this.specialtiesById.find(u=>u.id===r.id))})))),n(this.destroySubject)):v(this.specialties.map(t=>({id:t.id,name:t.name,selected:!1})))}openModal(e){let t=this.dialog.open(K,{data:{fields:[{field:"name",type:"info",value:e}]}});return t.afterClosed().pipe(I(()=>t),n(this.destroySubject))}mapToTableData(e){return e.map(le=>{var D=le,{id:t,lastModified:i,expiryDate:r,developerId:u,developerName:_,statusId:T,statusName:Z,educationFormName:ee,educationFormId:ue,title:te,year:ie}=D,re=A(D,["id","lastModified","expiryDate","developerId","developerName","statusId","statusName","educationFormName","educationFormId","title","year"]);return E(k({id:t,\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435:te,\u0421\u043A\u0430\u0447\u0430\u0442\u044C:{display:"\u0441\u043A\u0430\u0447\u0430\u0442\u044C",download:()=>this.downloadFile(t)},\u0413\u043E\u0434:ie,\u0412\u0435\u0434\u0443\u0449\u0438\u0439:_,\u0424\u043E\u0440\u043C\u0430:ee,\u0421\u0442\u0430\u0442\u0443\u0441\u044B:Z},re),{\u0418\u0437\u043C\u0435\u043D\u0451\u043D:new Date(i).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit"}),"\u0421\u0440\u043E\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F":new Date(r).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit"})})})}downloadFile(e){this.curriculumArchiveService.saveCurriculumAsWordToClient(e)}onEdit(e){}onDelete(e){}};o.\u0275fac=function(t){return new(t||o)(a(x),a(J),a(b),a(C),a(S),a(y),a(f))},o.\u0275cmp=B({type:o,selectors:[["archive"]],standalone:!0,features:[Q([x,b,C,S,y,f]),W],decls:9,vars:1,consts:[[1,"main-container"],[1,"title"],[1,"search-and-button"],[1,"search-bar"],[3,"searchEvent"],[1,"tablic"],[3,"pageIndex","data","totalCount"],[3,"pageIndex","data","totalCount","downloadCallback","delete","edit","pageChange"]],template:function(t,i){t&1&&(h(0,"div",0)(1,"div",1),L(2,"\u0410\u0440\u0445\u0438\u0432 \u0443\u0447\u0435\u0431\u043D\u044B\u0435 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u044B"),g(),H(3,"br"),h(4,"div",2)(5,"div",3)(6,"search",4),j("searchEvent",function(u){return i.onPageChange(1,u)}),g()()(),h(7,"div",5),O(8,ae,1,3,"tablec",6),g()()),t&2&&(M(8),$(8,i.tableData?8:-1))},dependencies:[N,G,X],styles:[".title[_ngcontent-%COMP%]{color:var(--Colors-gray-600, #475569);white-space:nowrap;font:400 24px/32px Inter,-apple-system,Roboto,Helvetica,sans-serif;padding-left:3px}.create-curriculum-button[_ngcontent-%COMP%]{color:var(--Colors-white, #fff);white-space:nowrap;border-radius:4px;box-shadow:0 1px 2px -1px #0000001a,0 1px 3px #0000001a;background-color:var(--Colors-primary-500, #0ea5e9);align-self:stretch;justify-content:center;padding:8px 16px;font:800 16px/143% Inter,-apple-system,Roboto,Helvetica,sans-serif;border:none;cursor:pointer;margin-left:auto}.search-and-button[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.main-container[_ngcontent-%COMP%]{border-radius:8px;justify-content:space-between;display:flex;flex-direction:column;padding-top:20px;padding-right:30px;padding-left:20px}"]});let s=o;return s})();export{Fe as ArchiveComponent};
