import{a as Q,b as q,c as h}from"./chunk-2B2SB72D.js";import{a as v,c as z,d as A}from"./chunk-MN3BMMZP.js";import{Aa as C,Ba as m,F as f,G as o,H as D,La as _,Oa as V,P as T,Pa as O,T as b,U as g,a as U,ba as N,c as w,ca as x,g as M,ha as P,ja as k,l,lb as H,m as E,n as I,na as B,ra as d,sa as p,ta as R,u as j,xa as F,y as u}from"./chunk-KKIUVDZZ.js";function G(c,a){if(c&1){let s=F();d(0,"tablec",8),C("delete",function(e){b(s);let t=m();return g(t.onDelete(e))})("edit",function(e){b(s);let t=m();return g(t.onEdit(e))})("pageChange",function(e){b(s);let t=m();return g(t.onPageChange(e,t.currentSearchQuery))}),p()}if(c&2){let s=m();k("pageIndex",s.pageIndex)("data",s.tableData)("totalCount",s.totalCount)}}var ie=(()=>{let a=class a{constructor(n,e){this.userService=n,this.dialog=e,this.currentSearchQuery="",this.pageIndex=1,this.destroySubject=new M}ngOnInit(){this.getUsers(this.pageIndex,10)}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}onPageChange(n=1,e=""){this.currentSearchQuery=e,this.pageIndex=n,this.userService.searchUsers(e,n,10).pipe(o(this.destroySubject),u(t=>(this.openModal(t.error),l(null)))).subscribe(t=>{t&&(this.users=t.users,this.totalCount=t.total,this.tableData=this.mapToTableData(t.users))})}getUsers(n,e){this.userService.getUsersForUserComponent(n,e).pipe(o(this.destroySubject),u(t=>(this.openModal(t.error),l(null)))).subscribe(t=>{t&&(this.users=t.users,this.totalCount=t.total,this.tableData=this.mapToTableData(t.users))})}onEdit(n){this.userService.getUserById(n).pipe(f(e=>{let t=[{field:"name",fieldName:"Name",type:"string",value:e.name},{field:"contact",fieldName:"Contact",type:"string",value:e.contact},{field:"role",fieldName:"Role",type:"string",value:e.role},{field:"password",fieldName:"Password",type:"string",value:e.password}],r=[{field:"save-button ",type:"submit",value:"Save"},{field:"cancel-button",fieldName:"Cancel",type:"button",value:"Cancel",click:()=>i.close()}],i=this.dialog.open(h,{data:{fields:t,buttons:r}});return i.afterClosed()}),j(e=>e!==void 0),u(e=>(this.openModal(e.error),console.error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",e),E(e))),o(this.destroySubject)).subscribe(e=>{this.saveUser(e,n),this.getUsers(this.pageIndex,10)})}getUserById(n){return this.userService.getUserById(n).pipe(o(this.destroySubject))}saveUser(n,e){this.userService.updateUserById(e,n).pipe(f(()=>this.openModal("\u0414\u0430\u043D\u043D\u044B\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B")),u(t=>this.openModal(t.error)),o(this.destroySubject)).subscribe()}openModal(n){let e=this.dialog.open(h,{data:{fields:[{field:"name",type:"info",value:n}]}});return e.afterClosed().pipe(I(()=>e),o(this.destroySubject))}mapToTableData(n){return n.map(J=>{var S=J,{name:e,contact:t,role:r,password:i}=S,y=w(S,["name","contact","role","password"]);return U({\u0418\u043C\u044F:e,\u0418\u043D\u0444\u043E:t,\u0420\u043E\u043B\u044C:r,\u041F\u0430\u0440\u043E\u043B\u044C:i},y)})}createUser(){let n=[{field:"name",fieldName:"Name",type:"string",value:"user"},{field:"contact",fieldName:"Contact",type:"string",value:"user info"},{field:"role",fieldName:"Role",type:"string",value:"user"},{field:"password",fieldName:"Password",type:"string",value:""}],e=[{field:"save-button ",type:"submit",value:"Create"},{field:"cancel-button",fieldName:"Cancel",type:"button",value:"Cancel",click:()=>t.close()}],t=this.dialog.open(h,{data:{fields:n,buttons:e}});t.afterClosed().pipe(f(r=>r?this.userService.createUser(r).pipe(D(i=>this.openModal(i.message)),u(i=>(this.openModal(i.error),l(null)))):l(null)),o(this.destroySubject)).subscribe(()=>{this.getUsers(this.pageIndex,10)})}onDelete(n){let e=[{field:"name",type:"info",value:"\u0412\u044B \u0442\u043E\u0447\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E\u0433\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F?"}],t=[{field:"save-button ",type:"submit",value:"\u0414\u0430"},{field:"cancel-button",fieldName:"Cancel",type:"button",value:"\u041D\u0435\u0442",click:()=>r.close()}],r=this.dialog.open(h,{data:{fields:e,buttons:t}});r.afterClosed().pipe(f(i=>i?this.userService.deleteUser(n).pipe(u(y=>(this.openModal(y.error),l(null)))):l(null)),o(this.destroySubject)).subscribe(()=>{this.getUsers(this.pageIndex,10)})}};a.\u0275fac=function(e){return new(e||a)(x(v),x(Q))},a.\u0275cmp=T({type:a,selectors:[["user-content"]],standalone:!0,features:[V([v]),O],decls:11,vars:1,consts:[[1,"main-container"],[1,"title"],[1,"search-and-button"],[1,"search-bar"],[3,"searchEvent"],[1,"create-user-button",3,"click"],[1,"tablic"],[3,"pageIndex","data","totalCount"],[3,"pageIndex","data","totalCount","delete","edit","pageChange"]],template:function(e,t){e&1&&(d(0,"div",0)(1,"div",1),_(2,"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0438"),p(),R(3,"br"),d(4,"div",2)(5,"div",3)(6,"search",4),C("searchEvent",function(i){return t.onPageChange(1,i)}),p()(),d(7,"button",5),C("click",function(){return t.createUser()}),_(8," \u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F "),p()(),d(9,"div",6),P(10,G,1,3,"tablec",7),p()()),e&2&&(N(10),B(10,t.tableData?10:-1))},dependencies:[H,z,q,A],styles:[".title[_ngcontent-%COMP%]{color:var(--Colors-gray-600, #475569);white-space:nowrap;font:400 24px/32px Inter,-apple-system,Roboto,Helvetica,sans-serif;padding-left:3px}.create-user-button[_ngcontent-%COMP%]{color:var(--Colors-white, #fff);white-space:nowrap;border-radius:4px;box-shadow:0 1px 2px -1px #0000001a,0 1px 3px #0000001a;background-color:var(--Colors-primary-500, #0ea5e9);align-self:stretch;justify-content:center;padding:8px 16px;font:800 16px/143% Inter,-apple-system,Roboto,Helvetica,sans-serif;border:none;cursor:pointer;margin-left:auto}.search-and-button[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.main-container[_ngcontent-%COMP%]{border-radius:8px;justify-content:space-between;display:flex;flex-direction:column;padding-top:20px;padding-right:30px;padding-left:20px}"]});let c=a;return c})();export{ie as UserContentComponent};
